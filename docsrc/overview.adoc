== Application Overview

This project documents and builds a graphical simulation tool for driving a
`WETS` information model that has been instrumented to communicate its state
to a https://nats.io/[NATS] server. You are reading a
<<literate-programming,literate programing document>>
that contains both documentation and source code.

The document product is both HTML PDF files containing documentation and code.

The generated code product -- `wetselm` -- is a web application in the
https://elm-lang.org/[elm] programming language. Some details may be provided
regarding the `elm` language but, since this is not meant as a tutorial, the
focus is on the purpose and implementation of the application. You are
encouraged to read the extensive https://guide.elm-lang.org/[Elm Guide] for
more information.

image::wetselm-ui.png[]

`wetselm` presents a 2-gate canal lock system that interacts with a `WETS`
executable information module to display the state of various entities
represented in that model: gates, valves, chambers, and vessels. Communication
is accomplished via a https://nats.io/[NATS] server.


.WETS messaging path using NATS
[pikchr]
----
$margin = 0.4
right; box invis wid 100% ht 50%
arrow <-
M1: box "Wets.1" wid 100% ht 50% fill bisque
arrow <-
box invis wid 100% ht 50%
box same as first box with .t at bottom of first box
arrow ->
M2: box "Wets.client" same as 2nd box
arrow ->
box invis wid 100% ht 50%
// cover the invisible boxes
box "wets-s" with .t at top of first box fill lightblue
box "wetselm" with .t at top of 3rd box fill lightpink
// nats-server box under the message boxes
box ht (M1.n.y-M2.s.y)+$margin wid M1.wid+$margin \
    at M1.s fill 0xe8d8d0 behind M1
"NATS-server" below at 1.33cm south of last box
----

`wetselm` will send `Wets.1` messages to `wets-s` via the `nats-server` and
`wets-s` will publish client messages on the `Wets-client` channel. All
messaging is done in JSON.

This documented is structured so that every `elm` module has its own
section,

<<Main.adoc,Main>>:: The main `elm` entry point
<<Wets.adoc,Wets>>:: Contains helper functions for encoding and decoding JSON
  messages for NATS
<<Util.adoc,Util>>:: Utility functions are refactored here to reduce noise in
  other modules
<<UI.adoc,UI>>:: User interface details like various glyphs as well as theming
  and typography.

=== Literate programming [[literate-programming]]

As a https://en.wikipedia.org/wiki/Literate_programming[literate programming document]
the application source code is woven into this document and can be
untangled into working source code as well as the document you are reading.
footnote:[The words, tangle and weave, are established literate programming
terms.] A `Makefile` is provided to build the code and document artifacts so
the detailed mechanism is described there and not in this document.

WARNING: Since the application is generated by this document, fixing
bugs and adding features *must* be done by editing this document.

The `atangle` tool is used for extracting the tangled code. Within
this document you will find code blocks headed with tags that `atangle` will
recognize for organizing the output of the code.

TIP: In this document, final assembly of the code blocks is done in a section
titled _Code Layout_.
